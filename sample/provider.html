<!DOCTYPE html>
<head>
  <meta charset=utf-8>
  <meta name="description" content="Acthesis test">
  <title>Acthesis test - Provider</title>
</head>
<body>
  <h1>Acthesis test - Provider</h1>
  <h2>Shared URLS</h2>
  <ul id="shared">
  </ul>
  <script src="engine.io.js"></script>
  <script src="activity-common.js"></script>
  <script src="activity-client.js"></script>
  <script>
window.addEventListener('load', function () {
  var sharedList = document.getElementById('shared');
  if (typeof window.MozActivity === 'undefined') {
    var acthesis, options, description, handler, activityUrl;
    activityUrl = window.location.toString().split(/[\?#]/)[0];
    options = {
      server: window.location.protocol + "//" + window.location.host + "/activity",
      ws: "ws://" + window.location.host
    };
    acthesis = new Acthesis(options);
    description = new ActivityHandlerDescription('share', activityUrl, '', false, null);
    acthesis.registerActivityHandler(description);
    handler = function (message) {
      "use strict";
      if (!(message instanceof ActivityRequestHandler)) {
        console.error("Message should be an ActivityRequestHandler");
      }
      console.log("Sharing", message);
      sharedList.innerHTML += "<li>" + message.source.url + "</li>";
      message.postResult(message.source.url);
    };
    navigator.setMessageHandler('share', handler);
    acthesis.start('Test Provider');
  }
  //console.log(navigator.mozHasPendingMessage('share'));
  //console.log(navigator.mozHasPendingMessage('pick'));
});
  </script>
</body>
</html>

