<!DOCTYPE html>
<head>
  <meta charset=utf-8>
  <meta name="description" content="Acthesis test">
  <title>Acthesis test - Provider</title>
</head>
<body>
  <h1>Acthesis test - Provider</h1>
  <h2>Shared URLS</h2>
  <ul id="shared">
  </ul>
  <div>
    <button id="actionOk">OK</button>
    <button id="actionKo">KO</button>
  </div>
  <script src="engine.io.js"></script>
  <script src="activity-client.js"></script>
  <script>
window.addEventListener('load', function () {
  var sharedList = document.getElementById('shared');
  if (typeof window.MozActivity === 'undefined') {
    var manifest = {
      "activities": {
        "share": {
          "href": null,        // default to current URL
          "disposition": null, // 'window' (default) or 'inline'
          "filters": {
            "type": []         // @TODO
          },
          "returnValue": true
        }
      }
    }
    new Acthesis(null, manifest);
  }
  actionOk = document.getElementById('actionOk');
  actionKo = document.getElementById('actionKo');
  handler = function (message) {
    "use strict";
    if (!(message instanceof ActivityRequestHandler)) {
      console.error("Message should be an ActivityRequestHandler");
    }
    console.log("Sharing", message);
    sharedList.innerHTML += "<li>" + message.source.url + "</li>";
    function ok () {
      message.postResult(message.source.url);
      actionOk.removeEventListener('click', ok);
      actionKo.removeEventListener('click', ko);
      window.close();
    }
    function ko () {
      message.postError("USER CANCELED");
      actionOk.removeEventListener('click', ok);
      actionKo.removeEventListener('click', ko);
      window.close();
    }
    actionOk.addEventListener('click', ok);
    actionKo.addEventListener('click', ko);
  };
  navigator.setMessageHandler('share', handler);
  if (navigator.mozHasPendingMessage('share')) {
    console.log("PENDING");
  } else {
    console.log("Nothing pending");
  }
});
  </script>
</body>
</html>

